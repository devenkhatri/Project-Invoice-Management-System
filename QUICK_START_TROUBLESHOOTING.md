# Quick Start Troubleshooting Guide

This guide helps you resolve common issues when starting the Project Invoice Management System for the first time.

## üö® Common Startup Errors

### 1. "Unknown sheet: Automation_Rules" Error

**Problem**: The backend fails to start with a SheetsService error about missing sheets.

**Solution**:
```bash
# Step 1: Set up your Google Sheets first
cd backend
npm run setup-sheets:full

# Step 2: Verify the setup
npm run setup-sheets:validate

# Step 3: Start the server
npm run dev:clean
```

**Root Cause**: The automation service tries to read sheets that don't exist yet.

### 2. "EADDRINUSE: address already in use :::5000" Error

**Problem**: Port 5000 is already being used by another process.

**Solutions**:

**Option A - Kill the existing process:**
```bash
# Kill process on port 5000
cd backend
npm run kill-port

# Then start the server
npm run dev
```

**Option B - Use a different port:**
```bash
# Use port 5001 instead
PORT=5001 npm run dev
```

**Option C - Find and kill the process manually:**
```bash
# Find what's using port 5000
lsof -i :5000

# Kill the specific process (replace PID with actual process ID)
kill -9 <PID>
```

### 3. Google Sheets Authentication Errors

**Problem**: "The caller does not have permission" or "Invalid credentials"

**Solution**:
```bash
# 1. Verify your environment variables
grep GOOGLE_SHEETS_ID backend/.env
grep GOOGLE_SERVICE_ACCOUNT_KEY backend/.env

# 2. Test the connection
cd backend
npm run setup-sheets:validate

# 3. If validation fails, recreate the setup
npm run setup-sheets:setup
```

**Checklist**:
- [ ] Service account JSON key is properly formatted in .env
- [ ] Spreadsheet is shared with service account email
- [ ] Google Sheets API is enabled in Google Cloud Console
- [ ] Service account has Editor permissions on the spreadsheet

### 4. Missing Environment Variables

**Problem**: Server fails to start due to missing configuration.

**Solution**:
```bash
# 1. Copy the example files
cp backend/.env.example backend/.env
cp frontend/.env.example frontend/.env

# 2. Run the setup script to generate JWT secrets
./setup.sh

# 3. Edit the .env files with your actual values
nano backend/.env
nano frontend/.env
```

**Required Variables**:
- `GOOGLE_SHEETS_ID`
- `GOOGLE_SERVICE_ACCOUNT_KEY`
- `JWT_SECRET` (auto-generated by setup script)
- `JWT_REFRESH_SECRET` (auto-generated by setup script)

## üîß Step-by-Step First-Time Setup

### Step 1: Environment Setup
```bash
# Clone and setup
git clone <repository-url>
cd project-invoice-management
./setup.sh  # This handles dependencies and basic setup
```

### Step 2: Google Cloud Setup
1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing
3. Enable APIs:
   - Google Sheets API
   - Google Drive API
4. Create Service Account:
   - Go to "IAM & Admin" > "Service Accounts"
   - Click "Create Service Account"
   - Download JSON key
5. Create Google Spreadsheet:
   - Go to [Google Sheets](https://sheets.google.com/)
   - Create new spreadsheet
   - Share with service account email (Editor access)
   - Copy spreadsheet ID from URL

### Step 3: Configure Environment
```bash
# Edit backend/.env
cd backend
nano .env

# Add your Google credentials:
GOOGLE_SHEETS_ID=your-spreadsheet-id-here
GOOGLE_SERVICE_ACCOUNT_KEY={"type":"service_account",...}
```

### Step 4: Initialize Google Sheets
```bash
# Setup all required sheets and headers
cd backend
npm run setup-sheets:full

# Verify the setup
npm run setup-sheets:validate
```

### Step 5: Start the Application
```bash
# Backend (terminal 1)
cd backend
npm run dev:clean

# Frontend (terminal 2)
cd frontend
npm start
```

## üîç Diagnostic Commands

### Check System Status
```bash
# Check Node.js version (should be 18+)
node --version

# Check if ports are available
lsof -i :5000  # Backend
lsof -i :3000  # Frontend

# Check environment files exist
ls -la backend/.env frontend/.env
```

### Test Google Sheets Connection
```bash
cd backend

# Test authentication
npm run setup-sheets:validate

# Check sheet structure
npm run sheets:validate

# View sheet contents (if data exists)
npm run sheets:check
```

### Test Backend API
```bash
# Health check (after server starts)
curl http://localhost:5000/health

# API documentation
curl http://localhost:5000/api
```

## üõ†Ô∏è Advanced Troubleshooting

### Reset Google Sheets
```bash
cd backend

# Backup existing data (if any)
npm run sheets:backup

# Recreate all sheets
npm run setup-sheets:setup

# Restore data (if needed)
npm run sheets:restore backup-file.json
```

### Clean Installation
```bash
# Remove all dependencies
rm -rf backend/node_modules frontend/node_modules

# Remove build artifacts
rm -rf backend/dist frontend/build

# Reinstall everything
./setup.sh
```

### Debug Mode
```bash
# Enable debug logging
DEBUG_MODE=true npm run dev

# Check logs
tail -f backend/logs/app.log
```

## üìû Getting Help

### Before Asking for Help
1. **Check this guide** for your specific error
2. **Run diagnostic commands** to gather information
3. **Check the logs** for detailed error messages
4. **Verify environment setup** using the validation commands

### Information to Include
When reporting issues, include:
- Operating system and Node.js version
- Complete error message with stack trace
- Output of diagnostic commands
- Your environment configuration (without sensitive data)

### Resources
- [Environment Setup Guide](ENVIRONMENT_SETUP_GUIDE.md) - Detailed configuration
- [Troubleshooting Guide](TROUBLESHOOTING.md) - Comprehensive troubleshooting
- [API Documentation](docs/docs/api/overview.md) - API reference

## üéØ Quick Fixes Summary

| Error | Quick Fix |
|-------|-----------|
| Unknown sheet error | `npm run setup-sheets:full` |
| Port in use | `npm run kill-port && npm run dev` |
| Auth error | Check service account sharing |
| Missing .env | `./setup.sh` |
| Build errors | `rm -rf node_modules && npm install` |

## ‚úÖ Success Indicators

You'll know everything is working when:
- ‚úÖ Backend starts without errors on port 5000
- ‚úÖ Frontend loads at http://localhost:3000
- ‚úÖ Health check returns OK: `curl http://localhost:5000/health`
- ‚úÖ Google Sheets validation passes
- ‚úÖ No error messages in console logs

---

**Need more help?** Check the comprehensive [TROUBLESHOOTING.md](TROUBLESHOOTING.md) guide or the [ENVIRONMENT_SETUP_GUIDE.md](ENVIRONMENT_SETUP_GUIDE.md) for detailed setup instructions.